<!DOCTYPE html>
<html> 
<head>
	<title>Data Collection</title>
	<meta charset="UTF-8" name="collection" content="width=device-width, initial-scale=1.0"/>
	<style type="text/css">
		h1 {
			text-align: center;
		}
		table, th, td {
			border: 1px solid black;
			border-collapseL collapse;
		}
		th, td { padding: 15px; }
		canvas {
			border:1px solid black;
			background-color:white;
		}
		p {
			font-size: 20px;
		}
		#details {
			padding-left: 50px;
			padding-right: 50px;
		}
		#instructions {
			padding-left: 75px;
			paddingright: 75px;
		}
		button {
			margin: auto;
			display: block;
			width: 200px;
			height: 60px;
			font-size: 22px;
			font-weight: bold;
		}
		#questionnaire {
			
			padding-left: 50px;
			paddingright: 50px;
		}
		#results_text {
			padding-left: 75px;
			paddingright: 75px;
		}
		#results_bar {
			padding-left: 75px;
			paddingright: 75px;
		}
		#site {
			font-size: 23px;
		}
	</style>

	<script src="https://d3js.org/d3.v6.min.js"></script>
</head>

<body>
<div class="header">
	<h1 id="title_text"></h1>
</div><hr>

<div id="details">
	<p> Our project is about testing which representation - text or graphical - is better for finding the median of a set of numbers. <br> 
		The hypothesis given to us for this assignment is: “For small numbers of values, numbers are more useful than graphical representations of data.” <br>
		We want to test whether it is better to use text or graphical representation - in our case, the graphical representation is a bar graph - when trying 
		to find the <b>median</b> value of a set of numbers. 
		You will see a set of number values on your screen. Their representations will either be in text format - the number itself, for the text representation or a bar 
		graph - for the graphical representation. You will then be asked to find the <b>median</b> of the numbers presented on your screen. Click the value that you think is right. 
		The time you take to click and whether your answer is right will be recorded. For each representation, you will get 4 different number of values shown. These are: <br>
			&emsp;&emsp;1. 3 numbers displayed on the screen <br>
			&emsp;&emsp;2. 5 numbers displayed on the screen <br>
			&emsp;&emsp;3. 9 numbers displayed on the screen <br>
			&emsp;&emsp;4. 25 numbers displayed on the screen <br>
		Each representation will go through each of these number of values shown on the screen. 
		You will be doing 5 trials for each of these. <br>
		We would also ask you to check that you satisfy the following requirements before you do the test: <br>
			&emsp;&emsp;1. You have 1920 x 1080 resolution <br>
			&emsp;&emsp;2. You use Google Chrome <br>
			&emsp;&emsp;3. You use a mouse when doing the trials <br>
</p>
</div>
<hr>
<div id="instructions">
	<h2 id="test">Final Notes:</h2>
	<p> 
		1. Please start with the <b>Text Trials first</b>.<br>
		2. Then, proceed to the <b>Bar Graph Trial</b>.<br>
		3. Once you press the begin buttons, the trials will start immediately - including the timer.<br>
		4. You will go throug all 20 trials of one representation. The results will be displayed at the <b>end of each representation</b>.<br>
		5. When you are done a trial, please take the time to copy and paste the results provided into a text file. You can copy the results of the two trials into one file.<br>
		6. Once you are done, send the text file to us through Slack.<br>
		7. Find the <b>median</b> value from the set of numbers shown.<br>
		8. Please click the buttons only once.<br>
		9. Click the "Begin Text Trials" button once when you are ready. <br></p>
</div>

<div id="text_container">
	<button type="button" onclick="beginTextTest()">Begin Text Trials</button><br>
</div>
<div id="results_text">
	<p id="rep"></p>
	<p id="num_values"></p>
	<p id="text_values"></p>
	<p id="correct"></p>
	<p id="time"></p>
	<p id="text_res"></p>
	<p id="instruct"></p>
</div>
<p id="error_check"></p>
<br>
<div id="bar_container">
	<button type="button" onclick="beginBarTest()">Begin Bar Graph Trials</button><br>
</div>
<div id="results_bar">
	<p id="bar_rep"></p>
	<p id="bar_num_values"></p>
	<p id="bar_values"></p>
	<p id="bar_correct"></p>
	<p id="bar_time"></p>
	<p id="bar_res"></p>
	<p id="bar_instruct"></p>
</div>

<script type="text/javascript">
	d3.select("#title_text").text("Text Representation vs. Graphical Representation")
		.style('color', 'black')
		.style('font-size', '40px')
	
	var trials_in_pr = false;
	// This was taken out of the function for a check being done
	var num_trial = 0;
	var NB_VALUES = 3;
	var conditions = [];
	var values_shown = [];
	var corr_ans = [];
	var clicks_made = [];
	var time_trials = [];
	
	function reset_counts() {
		num_trial = 0;
		NB_VALUES = 3;
		conditions = [];
		values_shown = [];
		corr_ans = [];
		time_trials = [];
		clicks_made = [];
	}
	
	function beginTextTest() {
		var width = 400;
		var height = 400;
		var time_start = new Date();
		var sort_values = [];
		var num;
		var med;
		
		//toggle bubble chart or text representation
		const REPRESENTATION = "text";
		//const REPRESENTATION = "bar";
		
		const MIN_VALUE = 0;
		const MAX_VALUE = 99;
		
		var svg = d3.select("#text_container")
			.append("svg")
			.attr("width", 400)
			.attr("height", 400)
			.style("margin-left", "auto")
			.style("margin-right", "auto")
			.style("display", "block")
			.style("border", "1px solid black");
			
		var values = d3.range(NB_VALUES).map(d => Math.floor(Math.random() * 100)) // the randomly generated set of values between 0 and 99
		num = values.length;
		values_shown = values_shown.concat(values + "--");
		// Creating a copy of the values to find median
		for(i = 0; i < num; i++) {
			sort_values[i] = values[i];
		}
		sort_values = sort_values.sort(function(x, y) { return x - y;});
		// Since all the amounts of numbers shown are odd
		var index = Math.floor(num/2);
		med = sort_values[index];
		corr_ans = corr_ans.concat(med);
		console.log(values);
		console.log(sort_values);
		console.log(med);
		
		var pad = 5 //padding for grid layout (text and bubble)
		var numCol, numRow; // number of columns, number of rows
		var bubble_min_radius, bubble_max_radius;
		var _w, _h;
		
		var font_size;
		
		if(NB_VALUES == 3){
			numCol = 3;
			numRow = 3;
			_w = width/numCol
			_h = height/numRow

			bubble_min_radius = 1;// arbitrary, could be 0, or something else
			bubble_max_radius = (_w/2 - pad*2);
			font_size = 50// arbitrary choice
		} else if(NB_VALUES == 9){
			numCol = 3;
			numRow = 3;
			_w = width/numCol
			_h = height/numRow

			bubble_min_radius = 1;// arbitrary, could be 0, or something else
			bubble_max_radius = (_w/2 - pad*2);
			font_size = 50// arbitrary choice
		} else if((NB_VALUES == 25) || (NB_VALUES == 5))  {
			numCol = 5;
			numRow = 5;
			_w = width/numCol
			_h = height/numRow

			bubble_min_radius = 1;// arbitrary, could be 0, or something else
			bubble_max_radius = (_w/2 - pad*2);
			font_size = 50// arbitrary choice
		}
			
		var sign = svg.selectAll('g') // create one group element to display each value, puts it at its position
			.data(values)
			.enter()
			.append('g')
			.attr('transform', function(d, i){
				switch(REPRESENTATION){
					case 'text':
						return 'translate(' + ((i%numCol)*_w + (pad/2)*-1) + ','+ ((Math.floor(i/numRow))*_h + (pad/2)*-1) +')'
					break;
					case 'bar':
						return 'translate(' + (i*width/NB_VALUES) + ','+ (height) +')'
					break;
					default: console.error('unknown representation',REPRESENTATION);
				}
			}).on('click', function(d, i){
				var time_click = new Date() - time_start;
				time_trials = time_trials.concat(time_click);
				clicks_made = clicks_made.concat(i);
				console.log("clicked: ", i)
				d3.select("svg").remove();
				num_trial = num_trial + 1;
				if(num_trial == 5) {
					if(NB_VALUES == 3) {
						//display results
						//delay or stop to let participants copy results
						//d3.select("#time").text(time_trials);
						//d3.select("#text_res").text(results);
						conditions = conditions.concat('n3', 'n3', 'n3', 'n3', 'n3');
						NB_VALUES = 5;
					} else if (NB_VALUES == 5) {
						//display results
						//delay or stop to let participants copy results
						//d3.select("#time").text(time_trials);
						//d3.select("#text_res").text(results);
						conditions = conditions.concat('n5', 'n5', 'n5', 'n5', 'n5');
						NB_VALUES = 9;
					} else if (NB_VALUES == 9) {
						//display results
						//delay or stop to let participants copy results
						//d3.select("#time").text(time_trials);
						//d3.select("#text_res").text(results);
						conditions = conditions.concat('n9', 'n9', 'n9', 'n9', 'n9');
						NB_VALUES = 25;
					} else if (NB_VALUES == 25) {
						//display results
						//delay or stop to let participants copy results
						conditions = conditions.concat('n25', 'n25', 'n25', 'n25', 'n25');
						d3.select("#rep").text("Representation was: " + REPRESENTATION);
						d3.select("#num_values").text("The conditions for each trial were: " + conditions);
						d3.select("#text_values").text("The values shown for each trial were: " + values_shown);
						d3.select("#time").text("Time taken for each trial: " + time_trials);
						d3.select("#correct").text("Correct Answers for each trial: " + corr_ans);
						d3.select("#text_res").text("Clicks for each test: " + clicks_made);
						d3.select("#instruct").text("Please copy your results onto a text file and move on to the Bar Graph Trials.")
						reset_counts();
						//cur_test_done = true;
						return;
					}
					num_trial = 0;
				}
				beginTextTest();
			}).style('cursor','pointer')//make it a pointer on mouseover
		
		if(REPRESENTATION == "text") {
		//create an 'invisible' circle of size half the max size of a bubble, simply to make it possible to click the smaller circles easily.
			sign.append('circle')
				.attr('cx', _w/2)
				.attr('cy', _w/2)
				.attr('r', bubble_max_radius/2)
				.style('fill', 'white')
	  
			sign.append('text')
				.attr('x', _w/2)
				.attr('y', _w/2)
				.attr('text-anchor','middle')
				.attr('font-size', font_size+"px")
				.text(d => d)
		} else if(REPRESENTATION == 'bar') {
	  
			var bar_scale = d3.scaleLinear()
				.domain([MIN_VALUE, MAX_VALUE])
				.range([0, height]);
	  
			sign.append('rect')
				.attr('x', 0)
				.attr('y', d => -bar_scale(d))
				.attr('width', width/NB_VALUES)
				.attr('height', d => bar_scale(d))
				.style('fill','black')
				.style('stroke','white')
		}
		return svg.node()
	}
	
	function beginBarTest() {
		//if(trials_in_pr == true) {
		//	return;
		//}
		
		var width = 400;
		var height = 400;
		var time_start = new Date();
		var sort_values = [];
		var num;
		var med;
		
		//toggle bubble chart or text representation
		//const REPRESENTATION = "text";
		const REPRESENTATION = "bar";
		
		const MIN_VALUE = 0;
		const MAX_VALUE = 99;
		
		var svg = d3.select("#bar_container")
			.append("svg")
			.attr("width", 400)
			.attr("height", 400)
			.style("margin-left", "auto")
			.style("margin-right", "auto")
			.style("display", "block")
			.style("border", "1px solid black");
			
		var values = d3.range(NB_VALUES).map(d => Math.floor(Math.random() * 100)) // the randomly generated set of values between 0 and 99
		num = values.length;
		values_shown = values_shown.concat(values + "--");
		// Creating a copy of the values to find median
		for(i = 0; i < num; i++) {
			sort_values[i] = values[i];
		}
		sort_values = sort_values.sort(function(x, y) { return x - y;});
		// Since all the amounts of numbers shown are odd
		var index = Math.floor(num/2);
		med = sort_values[index];
		corr_ans = corr_ans.concat(med);
		console.log(values);
		console.log(sort_values);
		
		var pad = 5 //padding for grid layout (text and bubble)
		var numCol, numRow; // number of columns, number of rows
		var bubble_min_radius, bubble_max_radius;
		var _w, _h;
		
		var font_size;
		
		if(NB_VALUES == 3){
			numCol = 3;
			numRow = 3;
			_w = width/numCol
			_h = height/numRow

			bubble_min_radius = 1;// arbitrary, could be 0, or something else
			bubble_max_radius = (_w/2 - pad*2);
			font_size = 50// arbitrary choice
		} else if(NB_VALUES == 9){
			numCol = 3;
			numRow = 3;
			_w = width/numCol
			_h = height/numRow

			bubble_min_radius = 1;// arbitrary, could be 0, or something else
			bubble_max_radius = (_w/2 - pad*2);
			font_size = 50// arbitrary choice
		} else if((NB_VALUES == 25) || (NB_VALUES == 5))  {
			numCol = 5;
			numRow = 5;
			_w = width/numCol
			_h = height/numRow

			bubble_min_radius = 1;// arbitrary, could be 0, or something else
			bubble_max_radius = (_w/2 - pad*2);
			font_size = 50// arbitrary choice
		}
			
		var sign = svg.selectAll('g') // create one group element to display each value, puts it at its position
			.data(values)
			.enter()
			.append('g')
			.attr('transform', function(d, i){
				switch(REPRESENTATION){
					case 'text':
						return 'translate(' + ((i%numCol)*_w + (pad/2)*-1) + ','+ ((Math.floor(i/numRow))*_h + (pad/2)*-1) +')'
					break;
					case 'bar':
						return 'translate(' + (i*width/NB_VALUES) + ','+ (height) +')'
					break;
					default: console.error('unknown representation',REPRESENTATION);
				}
			}).on('click', function(d, i){
				var time_click = new Date() - time_start;
				time_trials = time_trials.concat(time_click);
				clicks_made = clicks_made.concat(i);
				console.log("clicked: ", i);
				d3.select("svg").remove();
				num_trial = num_trial + 1;
				if(num_trial == 5) {
					if(NB_VALUES == 3) {
						conditions = conditions.concat('n3', 'n3', 'n3', 'n3', 'n3');
						NB_VALUES = 5;
					} else if (NB_VALUES == 5) {
						//display results
						//delay or stop to let participants copy results
						conditions = conditions.concat('n5', 'n5', 'n5', 'n5', 'n5');
						NB_VALUES = 9;
					} else if (NB_VALUES == 9) {
						//display results
						//delay or stop to let participants copy results
						conditions = conditions.concat('n9', 'n9', 'n9', 'n9', 'n9');
						NB_VALUES = 25;
					} else if (NB_VALUES == 25) {
						//display results
						//delay or stop to let participants copy results
						conditions = conditions.concat('n25', 'n25', 'n25', 'n25', 'n25');
						d3.select("#bar_instruct").text("Please copy your results onto a text file and move on to the questionnaire.")
						d3.select("#bar_rep").text("Representation was: " + REPRESENTATION);
						d3.select("#bar_num_values").text("The conditions for each trial were: " + conditions);
						d3.select("#bar_values").text("The values shown for each trial were: " + values_shown);
						d3.select("#bar_time").text("Time taken for each trial: " + time_trials);
						d3.select("#bar_correct").text("Correct Answers for each trial: " + corr_ans);
						d3.select("#bar_res").text("Clicks for each test: " + clicks_made);
						reset_counts();
						return;
					}
					num_trial = 0;
				}
				beginBarTest();
			}).style('cursor','pointer')//make it a pointer on mouseover
		
		if(REPRESENTATION == "text") {
		//create an 'invisible' circle of size half the max size of a bubble, simply to make it possible to click the smaller circles easily.
			sign.append('circle')
				.attr('cx', _w/2)
				.attr('cy', _w/2)
				.attr('r', bubble_max_radius/2)
				.style('fill', 'white')
	  
			sign.append('text')
				.attr('x', _w/2)
				.attr('y', _w/2)
				.attr('text-anchor','middle')
				.attr('font-size', font_size+"px")
				.text(d => d)
		} else if(REPRESENTATION == 'bar') {
	  
			var bar_scale = d3.scaleLinear()
				.domain([MIN_VALUE, MAX_VALUE])
				.range([0, height]);
	  
			sign.append('rect')
				.attr('x', 0)
				.attr('y', d => -bar_scale(d))
				.attr('width', width/NB_VALUES)
				.attr('height', d => bar_scale(d))
				.style('fill','black')
				.style('stroke','white')
		}
		return svg.node()
	}
</script>
<hr>
<div id="questionnaire">
	<p id="site"> When you are done <b>all</b> of the trials, please answer our questionnaire by clicking 
		<a href="https://docs.google.com/forms/d/e/1FAIpQLSdgNzRAJ3vmbrnPaKGgFfrzCVDUF4GN3qW2nsOvhhICNDy8sQ/viewform?usp=sf_link">here</a> 
		.This will help us with our analysis. Thank you for participating!
	</p>
</div>
  
</body>
</html>